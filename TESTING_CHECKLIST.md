# StockPicks AI - 테스트 체크리스트

이 체크리스트는 Claude Code가 작업 시 테스트를 빠뜨리지 않도록 하기 위한 필수 가이드입니다.

## 빠른 시작

```bash
# 테스트 실행 (필수)
npm run test:e2e

# 개발 + 테스트 (권장)
npm run dev  # 터미널 1
npm run test:e2e:ui  # 터미널 2
```

---

## 작업별 체크리스트

### 📝 버튼 수정 작업

**작업 전**:
- [ ] 어떤 버튼을 수정할지 확인
- [ ] 기존 테스트 파일 확인 (`tests/e2e/buttons.spec.ts`)

**작업 중**:
- [ ] 버튼 텍스트 변경
- [ ] 클릭 핸들러 수정
- [ ] 스타일 변경

**작업 후 (필수)**:
- [ ] `npm run test:e2e` 실행
- [ ] 모든 테스트 통과 확인
- [ ] 실패 시 버그 수정 및 재테스트 (최대 3회)
- [ ] 통과 시 커밋

**금지 사항**:
- ❌ 테스트 없이 커밋
- ❌ "나중에 테스트 추가" 약속
- ❌ 테스트 실패 무시

---

### 🚀 페이지/컴포넌트 추가 작업

**작업 전**:
- [ ] 컴포넌트 이름 확인
- [ ] 사용자 시나리오 정의

**작업 중**:
- [ ] 컴포넌트 생성
- [ ] 라우팅 추가 (필요 시)
- [ ] 이벤트 핸들러 구현

**작업 후 (필수)**:
- [ ] E2E 테스트 추가 (`tests/e2e/새파일.spec.ts`)
- [ ] 테스트 작성:
  - 페이지 렌더링 확인
  - 버튼 클릭 확인
  - null/undefined 처리 확인
- [ ] `npm run test:e2e` 실행
- [ ] 모든 테스트 통과 확인
- [ ] 커밋

**예시**:
```typescript
// tests/e2e/new-page.spec.ts
import { test, expect } from '@playwright/test';

test('새 페이지가 렌더링되어야 함', async ({ page }) => {
  await page.goto('/');
  await page.click('button:has-text("새 페이지")');
  await expect(page.locator('h1')).toBeVisible();
});
```

---

### 🛠️ 로직 수정 작업

**작업 전**:
- [ ] 어떤 로직을 수정할지 확인
- [ ] null/undefined 체크 필요 여부 확인

**작업 중**:
- [ ] 상태 관리 수정
- [ ] 조건부 렌더링 수정
- [ ] null 체크 추가

**작업 후 (필수)**:
- [ ] E2E 테스트 실행 (`npm run test:e2e`)
- [ ] Edge case 테스트 (빈 배열, null, undefined)
- [ ] 모든 테스트 통과 확인
- [ ] 커밋

**중요**: Recommendations 컴포넌트처럼 null 체크가 누락되면 크래시 발생!

---

### 🎨 스타일 변경 작업

**작업 전**:
- [ ] 어떤 스타일을 변경할지 확인

**작업 중**:
- [ ] Tailwind 클래스 수정
- [ ] 레이아웃 변경

**작업 후**:
- [ ] `npm run dev` 실행 후 브라우저 확인
- [ ] `npm run test:e2e` 실행 (선택사항)
- [ ] 시각적 확인 완료 시 커밋

**참고**: 스타일만 변경한 경우 E2E 테스트는 선택사항이지만, 레이아웃이 깨지지 않았는지 확인 필수

---

## 커밋 전 필수 체크리스트

```bash
# 1. 개발 서버 실행 확인
npm run dev  # ✅ 에러 없이 실행되어야 함

# 2. 빌드 확인
npm run build  # ✅ 에러 없이 빌드되어야 함

# 3. E2E 테스트 실행
npm run test:e2e  # ✅ 모든 테스트 통과해야 함
```

**모든 체크가 ✅일 때만 커밋**

---

## 테스트 실패 시 대응 방법

### 1단계: 에러 로그 확인
```bash
npm run test:e2e  # 에러 메시지 읽기
```

### 2단계: UI 모드로 디버깅
```bash
npm run test:e2e:ui  # 브라우저에서 직접 확인
```

### 3단계: 특정 테스트만 실행
```bash
npx playwright test buttons.spec.ts --debug
```

### 4단계: 버그 수정
- 에러 메시지 기반으로 코드 수정
- 재테스트 실행

### 5단계: 재시도
- 최대 3회 재시도
- 3회 실패 시 사용자에게 보고

---

## 자주 발생하는 문제

### ❌ 문제: "Element not found"
**원인**: 버튼 텍스트가 변경되었거나 셀렉터가 잘못됨
**해결**: 테스트 파일의 셀렉터를 최신 코드에 맞게 업데이트

### ❌ 문제: "Timeout exceeded"
**원인**: 페이지 로딩이 느림 또는 개발 서버 미실행
**해결**: `npm run dev` 실행 후 재시도

### ❌ 문제: "null is not an object"
**원인**: null 체크 누락
**해결**:
```typescript
// Before (잘못된 예시)
recommendations.map(...)

// After (올바른 예시)
recommendations?.map(...) || []
```

---

## 성공 사례

### ✅ 15개 버튼 수정 작업
**이전 방식** (잘못됨):
1. 15개 버튼 수정
2. 수동으로 몇 개 클릭
3. 테스트 없이 커밋
4. ❌ Recommendations null 체크 버그 발견

**올바른 방식**:
1. 15개 버튼 수정
2. `npm run test:e2e` 실행
3. 모든 테스트 통과 확인
4. ✅ 자신감 있게 커밋
5. ✅ 회귀 버그 발생 안 함

---

## 테스트 자동 실행 (향후 구현)

**pre-commit hook** 설정 시:
```bash
# 자동으로 커밋 전 테스트 실행
git commit -m "버튼 수정"
# → 자동으로 npm run test:e2e 실행
# → 통과 시 커밋, 실패 시 커밋 취소
```

---

## 요약

| 작업 종류 | E2E 테스트 | 빌드 확인 | 커밋 전 필수 |
|----------|-----------|---------|------------|
| 버튼 수정 | ✅ 필수 | ✅ 필수 | ✅ 필수 |
| 페이지 추가 | ✅ 필수 | ✅ 필수 | ✅ 필수 |
| 로직 수정 | ✅ 필수 | ✅ 필수 | ✅ 필수 |
| 스타일 변경 | 🔶 선택 | ✅ 필수 | ✅ 필수 |

**핵심 원칙**: UI 변경 = 테스트 필수 ✅

---

**마지막 업데이트**: 2025-11-27
